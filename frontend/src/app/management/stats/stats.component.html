<div class="container-fluid" *ngIf="statsObs | async as stats">
    <!-- Title -->
    <h3>{{'management.stats.title' | translate}}</h3>

    <hr>

    <div *ngIf="loading" class="alert alert-info">
        {{'management.stats.loading' | translate}}
    </div>

    <!-- If an error has occurred while fetching the stats, show the error -->
    <div *ngIf="errorOnRetrievingStats" class="alert alert-error">
        {{'management.stats.error' | translate}}
    </div>

    <ul class="nav-tabs">
        <li><a href="" [class]="activeTab === 0 ? 'active' : ''"
               (click)="changeTab($event, 0)">{{'management.stats.nav.occupancy' | translate}}</a></li>
        <li><a href="" [class]="activeTab === 1 ? 'active' : ''"
               (click)="changeTab($event, 1)">{{'management.stats.nav.overview' | translate}}</a></li>
    </ul>

    <div *ngIf="activeTab === 0">
        <div>
            <input type="checkbox" [(ngModel)]="showSpecificDateInsteadOfCurrentOrNext" (change)="onShowChange()"/>
            {{'management.stats.showSpecificDateInsteadOfCurrentOrNext' | translate}}
        </div>
        <div *ngIf="showSpecificDateInsteadOfCurrentOrNext">
            <input type="date" [(ngModel)]="date" (change)="onDateChange()"/>
        </div>
        <br>

        <p>
            {{'management.stats.info' | translate}}
        </p>
        <br>

        <div *ngIf="!loading && !errorOnRetrievingStats" class="fullwidth">
            <mat-grid-list cols="4" rowHeight="230px" gutterSize="5px" *ngIf="stats.length > 0; else noLocations">
                <mat-grid-tile *ngFor="let locationStat of stats">
                    <app-waffle [locationStat]="locationStat" class="waffle-chart"></app-waffle>
                </mat-grid-tile>
            </mat-grid-list>
        </div>
    </div>

    <div *ngIf="activeTab === 1">
        <div *ngIf="locations | async as locations">
            <label for="location">{{'management.stats.location' | translate}}</label>
            <select class="form-control" id="location" [(ngModel)]="selectedLocationId"
                    (change)="onLocationOverviewChange()">
                <option *ngFor="let location of locations" [value]="location.locationId">
                    {{location.name}}
                </option>
            </select>
        </div>
        <div>
            <label for="locationOverviewFrom">{{'management.stats.from' | translate}}</label>
            <input id="locationOverviewFrom" type="date" [(ngModel)]="locationOverviewFrom"
                   (change)="onLocationOverviewChange()"/>
            <label for="locationOverviewFrom">{{'management.stats.to' | translate}}</label>
            <input id="locationOverviewTo" type="date" [(ngModel)]="locationOverviewTo"
                   (change)="onLocationOverviewChange()"/>
        </div>
        <br>
        <hr>
        <h4>{{'management.stats.reservationsTotal' | translate}}</h4>
        <p>{{('management.stats.reservationsTotalMsg' | translate).replace('{total}', locationOverviewStat.reservationsTotal + '')}}</p>
        <h4>{{'management.stats.totalPerInstitution' | translate}}</h4>
        <div class="responsive-table table-wrapper fullwidth">
            <table style="width: 100%">
                <thead>
                <tr>
                    <th>{{'management.stats.institution' | translate}}</th>
                    <th>{{'management.stats.total' | translate}}</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let item of locationOverviewStat.reservationsTotalPerHOI | keyvalue">
                    <td>{{item.key}}</td>
                    <td>{{item.value}}</td>
                </tr>
                </tbody>
            </table>
        </div>
        <h4>{{'management.stats.totalPerDay' | translate}}</h4>
        <div class="responsive-table table-wrapper fullwidth">
            <table style="width: 100%">
                <thead>
                <tr>
                    <th>{{'management.stats.date' | translate}}</th>
                    <th>{{'management.stats.total' | translate}}</th>
                    <th *ngFor="let institution of institutions">{{institution}}</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let item of locationOverviewStat.reservationsPerDayPerHOI | keyvalue">
                    <td>{{item.key}}</td>
                    <td>{{locationOverviewStat.reservationsPerDay[item.key]}}</td>
                    <td *ngFor="let institution of institutions">{{item.value[institution] || 0}}</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<ng-template #noLocations>
    <div class="messages messages--info">
        {{'management.stats.noOpenLocations' | translate}}
    </div>
</ng-template>
